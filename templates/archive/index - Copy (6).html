<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
<!-- <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet"> -->

<script type="text/javascript" src="./static/js/hammer.min.js"></script>
<script type="text/javascript" src="static/js/jquery.min.js"></script>
<!-- <script src="//code.jquery.com/jquery-1.10.2.js"></script> -->
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- <script type="text/javascript" src="static/js/cornerstone.min.js"></script> -->
<script type="text/javascript" src="static/js/cornerstone2.js"></script>
<!-- <script type="text/javascript" src="static/js/dicomParser.min.js"></script> -->
<script type="text/javascript" src="static/js/dicomParser2.js"></script>
<!-- <script type="text/javascript" src="static/js/cornerstoneWADOImageLoader1.min.js"></script> -->
<script type="text/javascript" src="static/js/cornerstoneWADOImageLoader2.js"></script>
<script type="text/javascript" src="static/js/cornerstoneFileImageLoader.js"></script>
<script type="text/javascript" src="static/js/cornerstoneWebImageLoader.min.js"></script>
<script type="text/javascript" src="static/js/jpx.min.js"></script>
<script type="text/javascript" src="static/js/cornerstoneMath.js"></script>
<!-- <script type="text/javascript" src="static/js/cornerstoneTools2.min.js"></script> -->
<!-- <script type="text/javascript" src="static/js/controller.js"></script> -->

<script src="static/node_modules/cornerstone-tools/dist/cornerstoneTools.js"></script>
<script src="static/node_modules/cornerstone-math/dist/cornerstoneMath.js"></script>
<!-- <script src="static/node_modules/cornerstone-tools/dist/cornerstoneTools.js"></script> -->
<!-- <script src="static/node_modules/cornerstone-tools/dist/cornerstoneTools.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/cornerstone-tools@next"></script> -->


<script type='text/javascript'>


  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

  var current_xy_image;
  var current_xz_image;
  var current_yz_image;
  var image_aspect_ratio = {{image_aspect_ratio}};
  var zoomScale = 1
  var XShift = 0, YShift = 0; 
 


 function _initialize(){
  cornerstoneTools.init();
  cornerstoneWebImageLoader.external.cornerstone = cornerstone;
  cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
  cornerstoneWADOImageLoader.external.dicomParser = dicomParser;
  cornerstoneTools.external.cornerstoneMath = cornerstoneMath;
  cornerstoneTools.external.cornerstone = cornerstone;
  cornerstoneTools.external.Hammer = Hammer;
  cornerstoneWADOImageLoader.webWorkerManager.initialize({
    maxWebWorkers: navigator.hardwareConcurrency || 1,
    startWebWorkersOnDemand: true,
    taskConfiguration: {
      decodeTask: {
        initializeCodecsOnStartup: false,
        usePDFJS: false,
        strict: false,
      },
    },
  });
}
  function trackTransforms(ctx){
      var svg = document.createElementNS("http://www.w3.org/2000/svg",'svg');
      var xform = svg.createSVGMatrix();
      ctx.getTransform = function(){ return xform; };

      var savedTransforms = [];
      var save = ctx.save;
      ctx.save = function(){
          savedTransforms.push(xform.translate(0,0));
          return save.call(ctx);
      };
    
      var restore = ctx.restore;
      ctx.restore = function(){
        xform = savedTransforms.pop();
        return restore.call(ctx);
              };

      var scale = ctx.scale;
      ctx.scale = function(sx,sy){
        xform = xform.scaleNonUniform(sx,sy);
        return scale.call(ctx,sx,sy);
              };
    
      var rotate = ctx.rotate;
      ctx.rotate = function(radians){
          xform = xform.rotate(radians*180/Math.PI);
          return rotate.call(ctx,radians);
      };
    
      var translate = ctx.translate;
      ctx.translate = function(dx,dy){
          xform = xform.translate(dx,dy);
          return translate.call(ctx,dx,dy);
      };
    
      var transform = ctx.transform;
      ctx.transform = function(a,b,c,d,e,f){
          var m2 = svg.createSVGMatrix();
          m2.a=a; m2.b=b; m2.c=c; m2.d=d; m2.e=e; m2.f=f;
          xform = xform.multiply(m2);
          return transform.call(ctx,a,b,c,d,e,f);
      };
    
      var setTransform = ctx.setTransform;
      ctx.setTransform = function(a,b,c,d,e,f){
          xform.a = a;
          xform.b = b;
          xform.c = c;
          xform.d = d;
          xform.e = e;
          xform.f = f;
          return setTransform.call(ctx,a,b,c,d,e,f);
      };
    
      var pt  = svg.createSVGPoint();
      ctx.transformedPoint = function(x,y){
          pt.x=x; pt.y=y;
          return pt.matrixTransform(xform.inverse());
      }
    }

  function redraw(source, canvas_id){
        const canvas = document.getElementById(canvas_id);
        const ctx = canvas.getContext("2d");
        trackTransforms(ctx)
        var p1 = ctx.transformedPoint(0,0);
        var p2 = ctx.transformedPoint(canvas.width,canvas.height);
        ctx.clearRect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y);

        ctx.save();
        ctx.setTransform(1,0,0,1,0,0);
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.restore();

        var img = new Image();
        img.src = source;
        img.onload = function(){ 
          ctx.drawImage(img, 0, 0);

        }
        }

  var patients, xy_image_ids, xz_image_ids, yz_image_ids, patient_index;
  var XYImageIndex = 0, XZImageIndex = 255, YZImageIndex = 255;
  _initialize()





  $(document).ready(function() {


    var display_div = document.getElementById("display");
    display_div.style.display = "block"


    function load_data(patient_index){
        $.getJSON($SCRIPT_ROOT + '/_load_patient_data', {
          patientId: patients[patient_index],
        }, function(data) {
            xy_image_ids = data.xy_files
            xz_image_ids = data.xz_files
            yz_image_ids = data.yz_files
            console.log(patients[patient_index])
            // console.log(xy_image_ids[0])
            // console.log(xz_image_ids[0])
            // console.log(yz_image_ids[0])
        //     cornerstone.events.addEventListener('cornerstoneimageloadprogress', function(event) {
        // const eventData = event.detail;
        // 
        // });
        XYImageIndex = 0;
        XZImageIndex = 255;
        YZImageIndex = 255;
        loadViews()
          });
      };

    function onImageRendered(e) {
          // const eventData = e.detail;
          viewport = cornerstone.getViewport(e);
          console.log(viewport)
          // set the canvas context to the image coordinate system
          // cornerstone.setToPixelCoordinateSystem(eventData.enabledElement, eventData.canvasContext);
          // NOTE: The coordinate system of the canvas is in image pixel space.  Drawing
          // to location 0,0 will be the top left of the image and rows,columns is the bottom
               // right.
            const context = eventData.canvasContext;
            context.beginPath();
            context.strokeStyle = 'white';
            context.lineWidth = .5;
            context.rect(128, 90, 50, 60);
            context.stroke();
            context.fillStyle = "white";
            context.font = "6px Arial";
            context.fillText("Tumor Here", 128, 85);
          document.getElementById('topright').textContent = "Render Time:" + eventData.renderTimeInMs + " ms";
          document.getElementById('bottomleft').textContent = "WW/WL:" + Math.round(eventData.viewport.voi.windowWidth) + "/" + Math.round(eventData.viewport.voi.windowCenter);
          document.getElementById('bottomright').textContent = "Zoom:" + eventData.viewport.scale.toFixed(2);
          }
function updateView(element, frame, imageIndex){
  if (frame == 'XYFrame'){
      var url = 'wadouri:'+xy_image_ids[imageIndex]
  }
  else if (frame == 'XZFrame'){
      var url = xz_image_ids[imageIndex]
  }
  else if (frame == 'YZFrame'){
      var url = yz_image_ids[imageIndex]
  }
  cornerstone.loadAndCacheImage(url).then(function(image) {
            cornerstoneWADOImageLoader.wadouri.dataSetCacheManager.unload(url);
            const viewport = cornerstone.getViewport(element);
            if(viewport==undefined){
            $('#status').removeClass("label-other");
            $('#status').removeClass("label-success");
            $('#status').addClass("label-warning");
            $('#status').html(`Warning: Not Loded!`)
            document.getElementById("reload").style.display = "block";
          }
          else {
            $('#status').removeClass("label-other");
            $('#status').removeClass("label-warning");
            $('#status').addClass("label-success");
            $('#status').html(`Patient ${patients[patient_index]} is loaded.`);
            document.getElementById("reload").style.display = "none";
            if (frame == 'XYFrame'){
              _init_WL(element)
            };
            console.log(image.minPixelValue)
            console.log(image.maxPixelValue)
            console.log(viewport.voi.windowCenter)
            console.log(viewport.voi.windowWidth)
          }
  cornerstone.displayImage(element, image, viewport);          
 });
}
    function loadViews(){
      XYelement = document.getElementById('XYFrame')
      cornerstone.enable(XYelement);
      XZelement = document.getElementById('XZFrame')
      cornerstone.enable(XZelement);
      YZelement = document.getElementById('YZFrame')
      cornerstone.enable(YZelement);
      updateView(document.getElementById('XYFrame'), 'XYFrame', 0)
      updateView(document.getElementById('XZFrame'), 'XZFrame', 255)
      updateView(document.getElementById('YZFrame'), 'YZFrame', 255)
   
  };
   document.getElementById('reload').addEventListener('click', function (e) {
    loadViews()
   });

            // urls.forEach(imageId => cornerstone.loadAndCacheImage(imageId));
      // };
    // function loadMainView(frame, urls) {     
        // const scheme = 'wadouri'
        // const element = document.getElementById(frame);
        // cornerstone.enable(element);
        // cornerstoneTools.init();
         // var stack = {
         //        currentImageIdIndex : 0,
         //        imageIds: urls
         //      .map(seriesImage => `${scheme}:${seriesImage}`),
         //    };
        // var XYImageIndex = 0
        // updateView(element, frame, XYImageIndex)
        
        // var viewport = cornerstone.getViewport(element);
        // while (viewport === undefined){
        //   const viewport = cornerstone.getViewport(element);
          // console.log(viewport)
        // }
        

        // cornerstone.setViewport(element, viewport);

        
        // stack.imageIds.forEach(imageId => cornerstone.loadAndCacheImage(imageId));


  // cornerstoneWADOImageLoader.wadouri.dataSetCacheManager.load(urls[0], cornerstoneWADOImageLoader.internal.xhrRequest).then(function(dataSet) {
  //           stack.imageIds.forEach(imageId => cornerstone.loadAndCacheImage(imageId));
  //           cornerstone.loadAndCacheImage(stack.imageIds[0]).then(function(image) {
  //               cornerstoneWADOImageLoader.wadouri.dataSetCacheManager.unload(urls[0]);
  //               // cornerstoneTools.addStackStateManager(element, ['stack']);
  //               // cornerstoneTools.addToolState(element, 'stack', stack);
  //               cornerstone.displayImage(element, image);

  //               // if(loaded === false) {
  //               //   const apiTool = cornerstoneTools.PanTool;
  //               //   // console.log(apiTool)
  //               //   cornerstoneTools.addTool(apiTool);
  //               //   cornerstoneTools.setToolActive('Pan', { mouseButtonMask: 1 });
  //               //   cornerstoneTools.addTool(cornerstoneTools.StackScrollMouseWheelTool) 
  //               //   cornerstoneTools.setToolActive('StackScrollMouseWheel', {})
  //               //   loaded = true;
  //               // }
  //           }, function(err) {
  //               alert(err);
  //           });
  //       });

    // };

    document.getElementById('key_check').addEventListener('click', function (e) {
      $('#key').val("1001")
      $.getJSON($SCRIPT_ROOT + '/_load_patients', {
                  key: $('#key').val(),
              }, function(data) {
                  patient_index = 0
                  patients = data.patients
                  if (patients === undefined || patients.length == 0) 
                      {
                        $('#status').removeClass("label-other");
                        $('#status').addClass("label-danger");
                        $('#status').html(`Info: Access Denied!`)
                       }
                       else{
                        $('#status').removeClass("label-other");
                        $('#status').removeClass("label-danger");
                        $('#status').addClass("label-success");
                        $('#status').html(`Success!`)
                        document.getElementById("key_check").style.display = "none";
                        document.getElementById("key").style.display = "none";
                        load_data(0)
                        // display_div.style.display = "block"


                      }                  
                  // console.log(patients)
            });
        });
    

      document.getElementById('next_file').addEventListener('click', function (e) {
          patient_index += 1
          document.getElementById('prev_file').disabled = false;
          if (patient_index+1 == patients.length){
            document.getElementById('next_file').disabled = true;
          }
          load_data(patient_index)
      });

      document.getElementById('prev_file').addEventListener('click', function (e) {
        patient_index -= 1
        document.getElementById('next_file').disabled = false;
        if (patient_index == 0){
          document.getElementById('prev_file').disabled = true;
          }
        load_data(patient_index)
      });


    // setup handlers before we display the image



    // function updateView(imageIndex) {
    //   return cornerstone.loadAndCacheImage(imageIds[imageIndex]).then(function(image) {
    //                 currentImageIndex = imageIndex;
    //                 const viewport = cornerstone.getViewport(element);
    //                 // console.log(viewport)
    //                 cornerstone.displayImage(element, image, viewport);
    //             });
    //   };



        // var element = $('#dicomImage').get(0);
        // const elementXY = document.getElementById('dicomUrl');
        // cornerstone.enable(elementXY);
        
        // let currentImageIndex = 0;
        // var imageIds = [];
        



 



// const element = document.getElementById('dicomUrl');
// var status = cornerstoneTools.getToolState(element, 'stack')
// console.log(status)


    
function _init_WL(element){
  const viewport = cornerstone.getViewport(element);
  const image = cornerstone.getImage(element);
  console.log(image.minPixelValue)
  console.log(image.maxPixelValue)
  console.log(viewport.voi.windowCenter)
  console.log(viewport.voi.windowWidth)
  document.getElementById("minRange").min = Number(viewport.voi.windowCenter)-Number(viewport.voi.windowWidth)/2.0
  document.getElementById("minRange").max = Number(viewport.voi.windowCenter)+Number(viewport.voi.windowWidth)/2.0
  document.getElementById("minRange").value =  document.getElementById("minRange").min 
  document.getElementById("maxRange").min =  document.getElementById("minRange").min 
  document.getElementById("maxRange").max =  document.getElementById("minRange").max
   document.getElementById("maxRange").value =  document.getElementById("minRange").max
  $('#min_val').html($('#minRange').val())
  $('#max_val').html($('#maxRange').val())
  console.log(viewport)

}
document.getElementById('render').addEventListener('click', function (e) {

});


document.getElementById("minRange").oninput = function() {
          const elementXY =  document.getElementById('XYFrame');
          const viewport = cornerstone.getViewport(elementXY);
          var value = (this.value-this.min)/(this.max-this.min)*100
          this.style.background = 'linear-gradient(to right, white 0%, #fff ' + value + '%, #82CFD0 ' + value + '%, #82CFD0 100%)'
          if (this.value > Number($('#maxRange').val())){
            this.value  = $('#maxRange').val()
          }
          $('#min_val').html(this.value)
          $('#max_val').html($('#maxRange').val())
           viewport.voi.windowCenter = (Number(this.value)+Number($('#maxRange').val()))/2.0;
           viewport.voi.windowWidth = (Number($('#maxRange').val())-Number(this.value));
           cornerstone.setViewport(elementXY, viewport);
        };

document.getElementById("maxRange").oninput = function() {
          var value = (this.value-this.min)/(this.max-this.min)*100
          this.style.background = 'linear-gradient(to right, #82CFD0 0%, #82CFD0 ' + value + '%, #fff ' + value + '%, white 100%)'
           if (this.value < Number($('#minRange').val())){
            this.value  = $('#minRange').val()
          }
          $('#max_val').html(this.value)
          $('#min_val').html($('#minRange').val())
          const elementXY =  document.getElementById('XYFrame');
          const viewport = cornerstone.getViewport(elementXY);
          viewport.voi.windowCenter = (Number(this.value)+Number($('#minRange').val()))/2.0;
           viewport.voi.windowWidth = (Number(this.value)-Number($('#minRange').val()));
          cornerstone.setViewport(elementXY, viewport);
        };


        // console.log(elementXY)
        // console.log(imagePromise)
        // console.log(eventData.viewport.voi.windowWidth)
        // console.log(eventData.viewport.voi.windowCenter)
        // console.log(eventData.viewport.voi.windowMin)
        // console.log(eventData.viewport.voi.windowMax)
        // elementXY.addEventListener('cornerstoneimagerendered', onImageRendered);
        // onImageRendered(elementXY)


document.getElementById('capture').addEventListener('click', function (e) {

            // elementXY.style.width = '300px';
            // elementXY.style.height = '300px';
            // cornerstone.resize(elementXY);
          // const xy_context = document.getElementById("Canvas_xy").getContext("2d");; 
          // cornerstone.setTransform(1, 0, 0, 1, 0, 0);
          // cornerstone.disable(elementXY);

          x_capture = ((Number($('#xyx_slider').val())+256*(zoomScale-1))/zoomScale)-XShift;
          y_capture = ((Number($('#xyy_slider').val())+256*(zoomScale-1))/zoomScale)-YShift;
          z_capture = currentImageIndex;
          console.log($('#xyx_slider').val() + "    " + zoomScale + "    " + XShift)
          var met_points = [x_capture, y_capture, z_capture]
          var table = document.getElementById("metCenters");
          // Create an empty <tr> element and add it to the 1st position of the table:
          var row = table.insertRow(0);
          // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
          var cell = row.insertCell(0);
          // Add some text to the new cells:
          cell.innerHTML = met_points;

          
        });


document.getElementById('RESET').addEventListener('click', function (e) {
            // elementXY.style.width = '300px';
            // elementXY.style.height = '300px';
            // cornerstone.resize(elementXY);
          // const xy_context = document.getElementById("Canvas_xy").getContext("2d");; 
          // cornerstone.setTransform(1, 0, 0, 1, 0, 0);
          // cornerstone.disable(elementXY);

          
        });

// };
        function zoom(frame, scale){
          const element =  document.getElementById(frame);
          const viewport = cornerstone.getViewport(element);
            viewport.scale = scale 
            // const deltaX = (scale-1)*(XShift+Number($('#xyx_slider').val())-256) ;
            // const deltaY = (scale-1)*(YShift+Number($('#xyy_slider').val())-256);
            // console.log(deltaX + '  ' + deltaY)
            // viewport.translation.x -= deltaX;
            // viewport.translation.y -= deltaY;
            // XShift -= deltaX;
            // YShift -= deltaY;
            cornerstone.setViewport(element, viewport);

        }
        
document.getElementById('zoom_in').addEventListener('click', function (e) {
          zoomScale *= 1.5
          zoom('XYFrame', zoomScale)
          zoom('XZFrame', zoomScale)
          zoom('YZFrame', zoomScale)

            // console.log(viewport)
            // console.log(viewport.scale)
          
        });
document.getElementById('zoom_out').addEventListener('click', function (e) {
          zoomScale /= 1.5
          zoom('XYFrame', zoomScale)
          zoom('XZFrame', zoomScale)
          zoom('YZFrame', zoomScale)
            
           // console.log(zoomScale)


          
        });


          
          

          function getCursorPosition(canvas, event) {
          const rect = canvas.getBoundingClientRect()
          const x = event.clientX - rect.left
          const y = event.clientY - rect.top
          console.log("x: " + x + " y: " + y)
            return [x,y]
      };

function setIndicator(frame, cursorPosition) {
            let thisX = cursorPosition[0];
            let thisY = cursorPosition[1];
            if (frame == 'XYFrame') {
            $("#xyx_slider").val(thisX);
            $("#xyy_slider").val(thisY);
            $("#xzx_slider").val(thisX);
            $("#yzy_slider").val(thisY);
            var mainCanvas = 'Canvas_xy_overlay'

            renderVerLine('Canvas_xz_overlay', thisX, $("#xzz_slider").val());
            renderVerLine('Canvas_yz_overlay', thisY, $("#yzz_slider").val());
            }
            else if (frame == 'XZFrame') {
            $("#xyx_slider").val(thisX);
            $("#xzz_slider").val(thisY);
            $("#xzx_slider").val(thisX);
            $("#yzz_slider").val(thisY);
            var mainCanvas = 'Canvas_xz_overlay'
            renderVerLine('Canvas_xy_overlay',  thisX, $("#xyy_slider").val());
            renderHorLine('Canvas_yz_overlay',   $("#yzy_slider").val(), thisY);
            }
 
            else if (frame == 'YZFrame') {
            $("#xyy_slider").val(thisX);
            $("#xzz_slider").val(thisY);
            $("#yzy_slider").val(thisX);
            $("#yzz_slider").val(thisY);
            var mainCanvas = 'Canvas_yz_overlay'
            renderHorLine('Canvas_xy_overlay',   $("#xyx_slider").val(), thisX);
            renderHorLine('Canvas_xz_overlay',   $("#xzx_slider").val(), thisY);
            }
            
            renderVerLine(mainCanvas,  thisX, thisY);
            renderHorLine(mainCanvas,  thisX , thisY);

      };

  
      const overlay_element = document.getElementById('Canvas_xy_overlay'); 
      overlay_element.addEventListener('dblclick', function(e){ 
            let cursorPosition = getCursorPosition(overlay_element, e)
            setIndicator('XYFrame', cursorPosition)
            // let lastX = e.pageX;
            // let lastY = e.pageY;
          });
      const overlay_XZ_element = document.getElementById('Canvas_xz_overlay'); 
      overlay_XZ_element.addEventListener('dblclick', function(e){ 
            let cursorPosition = getCursorPosition(overlay_XZ_element, e)
            setIndicator('XZFrame', cursorPosition)
          });
    
      const overlay_YZ_element = document.getElementById('Canvas_yz_overlay'); 
      overlay_YZ_element.addEventListener('dblclick', function(e){ 
            let cursorPosition = getCursorPosition(overlay_YZ_element, e)
            setIndicator('YZFrame', cursorPosition)
          });



function handel_mouse_event(overlay_element, frame, e){
    const element =  document.getElementById(frame);
    const viewport = cornerstone.getViewport(element);

    let cursorPosition = getCursorPosition(overlay_element, e)
    let lastX = cursorPosition[0];
    let lastY = cursorPosition[1];
    const mouseButton = e.which;
    function mouseMoveHandler(e) {
      cursorPosition = getCursorPosition(overlay_element, e)
      let thisX = cursorPosition[0];
      let thisY = cursorPosition[1];
      const deltaX = thisX - lastX;
      const deltaY = thisY - lastY;
      lastX = thisX;
      lastY = thisY;

    if (mouseButton === 2) {
      viewport.voi.windowWidth += (deltaX / viewport.scale);
      viewport.voi.windowCenter += (deltaY / viewport.scale);
      cornerstone.setViewport(element, viewport);

    } 
    else if (mouseButton === 1) {
      viewport.translation.x += (deltaX / viewport.scale);
      viewport.translation.y += (deltaY / viewport.scale);
      cornerstone.setViewport(element, viewport);
      XShift += deltaX / viewport.scale;
      YShift += deltaY / viewport.scale;
      console.log('XShift: '+ XShift + 'YShift: '+ YShift)
      
      if (frame == 'XYFrame'){
        document.getElementById("xyy_slider").value = parseInt(document.getElementById("xyy_slider").value)+parseInt(deltaY)
        document.getElementById("xyx_slider").value = parseInt(document.getElementById("xyx_slider").value)+parseInt(deltaX)

        renderVerLine("Canvas_xy_overlay", $("#xyx_slider").val(), $("#xyy_slider").val());
        renderHorLine("Canvas_xy_overlay",  $("#xyx_slider").val() , $("#xyy_slider").val());
      }
      
      else if (frame == 'XZFrame'){
        document.getElementById("xzz_slider").value = parseInt(document.getElementById("xzz_slider").value)+parseInt(deltaY)
        document.getElementById("xzx_slider").value = parseInt(document.getElementById("xzx_slider").value)+parseInt(deltaX)

        renderVerLine("Canvas_xz_overlay", $("#xzx_slider").val(), $("#xzz_slider").val());
        renderHorLine("Canvas_xz_overlay",  $("#xzx_slider").val() , $("#xzz_slider").val());
      }
      else if (frame == 'YZFrame'){
        document.getElementById("yzz_slider").value = parseInt(document.getElementById("yzz_slider").value)+parseInt(deltaY)
        document.getElementById("yzy_slider").value = parseInt(document.getElementById("yzy_slider").value)+parseInt(deltaX)

        renderVerLine("Canvas_yz_overlay", $("#yzy_slider").val(), $("#yzz_slider").val());
        renderHorLine("Canvas_yz_overlay",  $("#yzy_slider").val() , $("#yzz_slider").val());
      }


      } 
      else if (mouseButton === 3) {
        console.log(viewport.scale)
        zoomScale += (deltaY / 100)
        // viewport.scale += (deltaY / 100);
        viewport.scale = zoomScale
        cornerstone.setViewport(element, viewport);
      }
    }

    function mouseUpHandler() {
      document.removeEventListener('mouseup', mouseUpHandler);
      document.removeEventListener('mousemove', mouseMoveHandler);
    }
    document.addEventListener('mousemove', mouseMoveHandler);
    document.addEventListener('mouseup', mouseUpHandler);

};


          overlay_element.addEventListener('mousedown', function (e) {
            handel_mouse_event(overlay_element, 'XYFrame', e)
            });

           overlay_XZ_element.addEventListener('mousedown', function (e) {
            handel_mouse_event(overlay_XZ_element, 'XZFrame', e)
            });

            overlay_YZ_element.addEventListener('mousedown', function (e) {
            handel_mouse_event(overlay_YZ_element, 'YZFrame', e)
            });







        const mouseWheelEvents = ['mousewheel', 'DOMMouseScroll'];
        mouseWheelEvents.forEach(function(eventType) {
                overlay_element.addEventListener(eventType, function (e) {
                  const elementXY =  document.getElementById('XYFrame');
                // Prevent page from scrolling
                e.preventDefault();
                // Firefox e.detail > 0 scroll back, < 0 scroll forward
                // chrome/safari e.wheelDelta < 0 scroll back, > 0 scroll forward
                if (e.wheelDelta < 0 || e.detail > 0) {
                    if (XYImageIndex < xy_image_ids.length-1) {
                      XYImageIndex += 1
                    }
                } else {
                    if (XYImageIndex > 0) {
                      XYImageIndex -= 1
                       
                    }
                }
                  updateView(elementXY, 'XYFrame', XYImageIndex)
                  $("#xzz_slider").val(XYImageIndex);
                  $("#yzz_slider").val(XYImageIndex);
                
                return false;
            });
        });





        // var index = 100
        // console.log(index);


    

    // drag_frame('Canvas_xy', 'Canvas_xy_overlay')

function renderHorLine(overlay, slider_val, value){
    const xz_o = document.getElementById(overlay);
    const xz_o_ctx = xz_o.getContext("2d");
    xz_o_ctx.clearRect(0, 0, xz_o.width, xz_o.height);
    xz_o_ctx.beginPath(); 
    xz_o_ctx.setLineDash([15, 5, 3, 5]);
    xz_o_ctx.strokeStyle = "#FF0000";
    xz_o_ctx.lineWidth = 1;
    xz_o_ctx.moveTo(0,value);
    xz_o_ctx.lineTo(xz_o.width,value);
    xz_o_ctx.stroke();
    xz_o_ctx.beginPath(); 
    xz_o_ctx.setLineDash([15, 5, 3, 5]);
    xz_o_ctx.strokeStyle = "#FF0000";
    xz_o_ctx.lineWidth = 1;
    xz_o_ctx.moveTo(slider_val,0);
    xz_o_ctx.lineTo(slider_val,xz_o.height);
    xz_o_ctx.stroke();
}

function renderVerLine(overlay, value, slider_val){
    const yz_o = document.getElementById(overlay);
    const yz_o_ctx = yz_o.getContext("2d");
    yz_o_ctx.clearRect(0, 0, yz_o.width, yz_o.height);
    yz_o_ctx.beginPath(); 
    yz_o_ctx.setLineDash([15, 5, 3, 5]);
    yz_o_ctx.strokeStyle = "#FF0000";
    yz_o_ctx.lineWidth = 1;
    yz_o_ctx.moveTo(value,0);
    yz_o_ctx.lineTo(value,yz_o.height);
    yz_o_ctx.stroke();
    yz_o_ctx.beginPath(); 
    yz_o_ctx.setLineDash([15, 5, 3, 5]);
    yz_o_ctx.strokeStyle = "#FF0000";
    yz_o_ctx.lineWidth = 1;
    yz_o_ctx.moveTo(0,slider_val);
    yz_o_ctx.lineTo(yz_o.width,slider_val);
    yz_o_ctx.stroke();

}



  $("#xzz_slider").change(function(){
    $("#result").text($(this).val());
    $("#yzz_slider").val($(this).val());
    renderHorLine("Canvas_xz_overlay",  "#xzx_slider", $(this).val())
    renderHorLine("Canvas_yz_overlay",  "#yzy_slider", $(this).val())

    $.getJSON($SCRIPT_ROOT + '/_get_xy_image', {
        z_val: this.value,
        y_val: $("#xyy_slider").val(),
        x_val: $("#xyx_slider").val(),
      }, function(data) {
        $("#result").text(data.xy_result);
        current_xy_image =  data.xy_result;
        // redraw(current_xy_image, "Canvas_xy")    
      });
      console.log(image_aspect_ratio)
      console.log(this.value*image_aspect_ratio[0]/image_aspect_ratio[2])
      updateTheImage(parseInt(this.value*image_aspect_ratio[0]/image_aspect_ratio[2]));
      
      return false;
    });
    $("#yzz_slider").change(function(){
    $("#result").text($(this).val());
    $("#xzz_slider").val($(this).val());
    renderHorLine("Canvas_xz_overlay",  $("#xzx_slider").val(), $(this).val())
    // const xz_o = document.getElementById("Canvas_xz_overlay");
    // const xz_o_ctx = xz_o.getContext("2d");
    // xz_o_ctx.clearRect(0, 0, xz_o.width, xz_o.height);
    // xz_o_ctx.beginPath(); 
    // xz_o_ctx.setLineDash([15, 5, 3, 5]);
    // xz_o_ctx.strokeStyle = "#FF0000";
    // xz_o_ctx.lineWidth = 1;
    // xz_o_ctx.moveTo(0,$(this).val());
    // xz_o_ctx.lineTo(xz_o.width,$(this).val());
    // xz_o_ctx.stroke();
    // xz_o_ctx.beginPath(); 
    // xz_o_ctx.setLineDash([15, 5, 3, 5]);
    // xz_o_ctx.strokeStyle = "#FF0000";
    // xz_o_ctx.lineWidth = 1;
    // xz_o_ctx.moveTo($('#xzx_slider').val(), 0);
    // xz_o_ctx.lineTo($('#xzx_slider').val(), xz_o.height);
    // xz_o_ctx.stroke();
    renderHorLine("Canvas_yz_overlay",  $("#yzy_slider").val() , $(this).val())
    // const yz_o = document.getElementById("Canvas_yz_overlay");
    // const yz_o_ctx = yz_o.getContext("2d");
    // yz_o_ctx.clearRect(0, 0, yz_o.width, yz_o.height);
    // yz_o_ctx.beginPath(); 
    // yz_o_ctx.setLineDash([15, 5, 3, 5]);
    // yz_o_ctx.strokeStyle = "#FF0000";
    // yz_o_ctx.lineWidth = 1;
    // yz_o_ctx.moveTo(0,$(this).val());
    // yz_o_ctx.lineTo(yz_o.width,$(this).val());
    // yz_o_ctx.stroke();
    // yz_o_ctx.beginPath(); 
    // yz_o_ctx.setLineDash([15, 5, 3, 5]);
    // yz_o_ctx.strokeStyle = "#FF0000";
    // yz_o_ctx.lineWidth = 1;
    // yz_o_ctx.moveTo($('#yzy_slider').val(),0);
    // yz_o_ctx.lineTo($('#yzy_slider').val(),yz_o.height);
    // yz_o_ctx.stroke();

    $.getJSON($SCRIPT_ROOT + '/_get_xy_image', {
        z_val: this.value,
        y_val: $("#xyy_slider").val(),
        x_val: $("#xyx_slider").val(),
      }, function(data) {
        $("#result").text(data.xy_result);
        current_xy_image = data.xy_result
        // redraw(current_xy_image, "Canvas_xy")
      });
    updateTheImage(this.value);
      return false;
    });
  $("#xyy_slider").change(function(){
    const canvas_id = "Canvas_xz";
    $("#result").text($(this).val());
    $("#yzy_slider").val($(this).val());
    renderHorLine("Canvas_xy_overlay",   $("#xyx_slider").val(), $(this).val())
    // const xy_o = document.getElementById("Canvas_xy_overlay");
    // const xy_o_ctx = xy_o.getContext("2d");
    // xy_o_ctx.clearRect(0, 0, xy_o.width, xy_o.height);
    // xy_o_ctx.beginPath(); 
    // xy_o_ctx.setLineDash([15, 5, 3, 5]);
    // xy_o_ctx.strokeStyle = "#FF0000";
    // xy_o_ctx.lineWidth = 1;
    // xy_o_ctx.moveTo(0,$(this).val());
    // xy_o_ctx.lineTo(xy_o.width,$(this).val());
    // xy_o_ctx.stroke();
    // xy_o_ctx.beginPath(); 
    // xy_o_ctx.setLineDash([15, 5, 3, 5]);
    // xy_o_ctx.strokeStyle = "#FF0000";
    // xy_o_ctx.lineWidth = 1;
    // xy_o_ctx.moveTo($("#xyx_slider").val(),0);
    // xy_o_ctx.lineTo($("#xyx_slider").val(),xy_o.height);
    // xy_o_ctx.stroke();
    renderVerLine("Canvas_yz_overlay" , $(this).val(),  $("#yzz_slider").val())
    // const yz_o = document.getElementById("Canvas_yz_overlay");
    // const yz_o_ctx = yz_o.getContext("2d");
    // yz_o_ctx.clearRect(0, 0, yz_o.width, yz_o.height);
    // yz_o_ctx.beginPath(); 
    // yz_o_ctx.setLineDash([15, 5, 3, 5]);
    // yz_o_ctx.strokeStyle = "#FF0000";
    // yz_o_ctx.lineWidth = 1;
    // yz_o_ctx.moveTo($(this).val(),0);
    // yz_o_ctx.lineTo($(this).val(),yz_o.height);
    // yz_o_ctx.stroke();
    // yz_o_ctx.beginPath(); 
    // yz_o_ctx.setLineDash([15, 5, 3, 5]);
    // yz_o_ctx.strokeStyle = "#FF0000";
    // yz_o_ctx.lineWidth = 1;
    // yz_o_ctx.moveTo(0,$('#yzz_slider').val());
    // yz_o_ctx.lineTo(yz_o.width,$('#yzz_slider').val());
    // yz_o_ctx.stroke();

    $.getJSON($SCRIPT_ROOT + '/_get_xz_image', {
        z_val: $("#xzz_slider").val(),
        y_val: this.value,
        x_val: $("#xzx_slider").val(),
      }, function(data) {
        $("#result").text(data.xz_result);
        current_xz_image = data.xz_result
        redraw(current_xz_image, canvas_id)
      });
      return false;
  });
    $("#yzy_slider").change(function(){
    $("#result").text($(this).val());
    $("#xyy_slider").val($(this).val());
    renderHorLine("Canvas_xy_overlay", $("#xyx_slider").val() , $(this).val())
    // const xy_o = document.getElementById("Canvas_xy_overlay");
    // const xy_o_ctx = xy_o.getContext("2d");
    // xy_o_ctx.clearRect(0, 0, xy_o.width, xy_o.height);
    // xy_o_ctx.beginPath(); 
    // xy_o_ctx.setLineDash([15, 5, 3, 5]);
    // xy_o_ctx.strokeStyle = "#FF0000";
    // xy_o_ctx.lineWidth = 1;
    // xy_o_ctx.moveTo(0,$(this).val());
    // xy_o_ctx.lineTo(xy_o.width,$(this).val());
    // xy_o_ctx.stroke();
    // xy_o_ctx.beginPath(); 
    // xy_o_ctx.setLineDash([15, 5, 3, 5]);
    // xy_o_ctx.strokeStyle = "#FF0000";
    // xy_o_ctx.lineWidth = 1;
    // xy_o_ctx.moveTo($("#xyx_slider").val(),0);
    // xy_o_ctx.lineTo($("#xyx_slider").val(),xy_o.height);
    // xy_o_ctx.stroke();
    renderVerLine("Canvas_yz_overlay" , $(this).val(), $("#yzz_slider").val())
    // const yz_o = document.getElementById("Canvas_yz_overlay");
    // const yz_o_ctx = yz_o.getContext("2d");
    // yz_o_ctx.clearRect(0, 0, yz_o.width, yz_o.height);
    // yz_o_ctx.beginPath(); 
    // yz_o_ctx.setLineDash([15, 5, 3, 5]);
    // yz_o_ctx.strokeStyle = "#FF0000";
    // yz_o_ctx.lineWidth = 1;
    // yz_o_ctx.moveTo($(this).val(),0);
    // yz_o_ctx.lineTo($(this).val(),yz_o.height);
    // yz_o_ctx.stroke();
    // yz_o_ctx.beginPath(); 
    // yz_o_ctx.setLineDash([15, 5, 3, 5]);
    // yz_o_ctx.strokeStyle = "#FF0000";
    // yz_o_ctx.lineWidth = 1;
    // yz_o_ctx.moveTo(0,$("#yzz_slider").val());
    // yz_o_ctx.lineTo(yz_o.width,$("#yzz_slider").val());
    // yz_o_ctx.stroke();

    $.getJSON($SCRIPT_ROOT + '/_get_xz_image', {
        z_val: $("#xzz_slider").val(),
        y_val: this.value,
        x_val: $("#xzx_slider").val(),
      }, function(data) {
        $("#result").text(data.xz_result);
        current_xz_image =  data.xz_result;
        redraw(current_xz_image, "Canvas_xz") 
      });
      return false;
  });
  $("#xyx_slider").change(function(){
    $("#result").text($(this).val());
    $("#xzx_slider").val($(this).val());
    renderVerLine("Canvas_xy_overlay" , $(this).val(), $("#xyy_slider").val())
    // const xy_o = document.getElementById("Canvas_xy_overlay");
    // const xy_o_ctx = xy_o.getContext("2d");
    // xy_o_ctx.clearRect(0, 0, xy_o.width, xy_o.height);
    // xy_o_ctx.beginPath(); 
    // xy_o_ctx.setLineDash([15, 5, 3, 5]);
    // xy_o_ctx.strokeStyle = "#FF0000";
    // xy_o_ctx.lineWidth = 1;
    // xy_o_ctx.moveTo($(this).val(),0);
    // xy_o_ctx.lineTo($(this).val(), xy_o.height);
    // xy_o_ctx.stroke();
    // xy_o_ctx.beginPath(); 
    // xy_o_ctx.setLineDash([15, 5, 3, 5]);
    // xy_o_ctx.strokeStyle = "#FF0000";
    // xy_o_ctx.lineWidth = 1;
    // xy_o_ctx.moveTo(0, $("#xyy_slider").val());
    // xy_o_ctx.lineTo(xy_o.width, $("#xyy_slider").val());
    // xy_o_ctx.stroke();
  renderVerLine("Canvas_xz_overlay", $(this).val(),  $("#xzz_slider").val() )
    // const xz_o = document.getElementById("Canvas_xz_overlay");
    // const xz_o_ctx = xz_o.getContext("2d");
    // xz_o_ctx.clearRect(0, 0, xz_o.width, xz_o.height);
    // xz_o_ctx.beginPath(); 
    // xz_o_ctx.setLineDash([15, 5, 3, 5]);
    // xz_o_ctx.strokeStyle = "#FF0000";
    // xz_o_ctx.lineWidth = 1;
    // xz_o_ctx.moveTo($(this).val(),0);
    // xz_o_ctx.lineTo($(this).val(),xz_o.height);
    // xz_o_ctx.stroke();
    // xz_o_ctx.beginPath(); 
    // xz_o_ctx.setLineDash([15, 5, 3, 5]);
    // xz_o_ctx.strokeStyle = "#FF0000";
    // xz_o_ctx.lineWidth = 1;
    // xz_o_ctx.moveTo(0, $("#xzz_slider").val());
    // xz_o_ctx.lineTo(xz_o.width,$("#xzz_slider").val());
    // xz_o_ctx.stroke();

    $.getJSON($SCRIPT_ROOT + '/_get_yz_image', {
        z_val: $("#yzz_slider").val(),
        y_val: $("#yzy_slider").val(),
        x_val: this.value,
      }, function(data) {
        $("#result").text(data.yz_result);
        current_yz_image =  data.yz_result;
        redraw(current_yz_image, "Canvas_yz") 
      });
      return false;
  });
    $("#xzx_slider").change(function(){
    $("#result").text($(this).val());
    $("#xyx_slider").val($(this).val());
    renderVerLine("Canvas_xy_overlay",  $(this).val(), $("#xyy_slider").val())
    // const xy_o = document.getElementById("Canvas_xy_overlay");
    // const xy_o_ctx = xy_o.getContext("2d");
    // xy_o_ctx.clearRect(0, 0, xy_o.width, xy_o.height);
    // xy_o_ctx.beginPath(); 
    // xy_o_ctx.setLineDash([15, 5, 3, 5]);
    // xy_o_ctx.strokeStyle = "#FF0000";
    // xy_o_ctx.lineWidth = 1;
    // xy_o_ctx.moveTo($(this).val(),0);
    // xy_o_ctx.lineTo($(this).val(), xy_o.height);
    // xy_o_ctx.stroke();
    // xy_o_ctx.beginPath(); 
    // xy_o_ctx.setLineDash([15, 5, 3, 5]);
    // xy_o_ctx.strokeStyle = "#FF0000";
    // xy_o_ctx.lineWidth = 1;
    // xy_o_ctx.moveTo(0, $("#xyy_slider").val());
    // xy_o_ctx.lineTo(xy_o.width, $("#xyy_slider").val());
    // xy_o_ctx.stroke();
    renderVerLine("Canvas_xz_overlay" , $(this).val(), $("#xzz_slider").val())
    // const xz_o = document.getElementById("Canvas_xz_overlay");
    // const xz_o_ctx = xz_o.getContext("2d");
    // xz_o_ctx.clearRect(0, 0, xz_o.width, xz_o.height);
    // xz_o_ctx.beginPath(); 
    // xz_o_ctx.setLineDash([15, 5, 3, 5]);
    // xz_o_ctx.strokeStyle = "#FF0000";
    // xz_o_ctx.lineWidth = 1;
    // xz_o_ctx.moveTo($(this).val(),0);
    // xz_o_ctx.lineTo($(this).val(),xz_o.height);
    // xz_o_ctx.stroke();
    // xz_o_ctx.beginPath(); 
    // xz_o_ctx.setLineDash([15, 5, 3, 5]);
    // xz_o_ctx.strokeStyle = "#FF0000";
    // xz_o_ctx.lineWidth = 1;
    // xz_o_ctx.moveTo(0, $("#xzz_slider").val());
    // xz_o_ctx.lineTo(xz_o.width, $("#xzz_slider").val());
    // xz_o_ctx.stroke();

    $.getJSON($SCRIPT_ROOT + '/_get_yz_image', {
        z_val: $("#yzz_slider").val(),
        y_val: $("#yzy_slider").val(),
        x_val: this.value,
      }, function(data) {
        $("#result").text(data.yz_result);
        current_yz_image =  data.yz_result;
        redraw(current_yz_image, "Canvas_yz")
      });
      return false;
  });
});
</script>
<style>
.slidecontainer {
  width: 100%;
}
.slider {
  -webkit-appearance: none;
  height: 5px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}
.slider:hover {
  opacity: 1;
}
.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 10px;
  height: 25px;
  background: #4CAF50;
  cursor: pointer;
}
.slider::-moz-range-thumb {
  width: 10px;
  height: 25px;
  background: #4CAF50;
  cursor: pointer;
}
.verticalcontainer {
  width: 100%;
  height: 100%;
}
.vertical {
  writing-mode: bt-lr;
  -webkit-appearance: slider-vertical;
  width: 10px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
  -webkit-transform: rotate(180deg);
  -moz-transform: rotate(180deg);
  -o-transform: rotate(180deg);
  -ms-transform: rotate(180deg);
  transform: rotate(180deg)
}
.vertical:hover {
  opacity: 1;
}
.vertical::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 35px;
  height: 10px;
  background: #4CAF50;
  cursor: pointer;
}
.vertical::-moz-range-thumb {
  width: 35px;
  height: 10px;
  background: #4CAF50;
  cursor: pointer;
}

input[type=range][orient=vertical]
{
    writing-mode: bt-lr; /* IE 
    -webkit-appearance: slider-vertical; /* WebKit */
    width: 8px;
    height: 175px;
    padding: 0 5px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse; 
}
#Canvas_xy{
    position:relative;
}
#Canvas_xy_overlay{
    position: absolute;
    left: calc(100% - 10px);
    z-index: 10;
}
/*#x_slider {
  direction: rtl;
}*/
    .btn
    {
        margin:5px;
        /*width:30px;*/
        height:30px;
    }
        .btn2
    {
      position: relative;
        
        /*top: 5px;*/
        left: 200px;
        /*margin:20px;*/
        /*width:50px;*/
    }
    table {
    /*border: 1px solid #CCC;*/
    border: none;
    border-collapse: collapse;
}

td {
    border: none;
}


#minRange {
  /*direction: rtl;*/
 background:  #82CFD0 ;
  border: solid 1px #82CFD0;
  border-radius: 8px;
  /*height: 7px;*/
  /*width: 356px;*/
  outline: none;
  transition: background 450ms ease-in;
  -webkit-appearance: none;

}
#maxRange {
  /*direction: rtl;*/
 background: , #82CFD0 ;
  border: solid 1px #82CFD0;
  border-radius: 8px;
  /*height: 10px;*/
  /*width: 356px;*/
  outline: none;
  transition: background 450ms ease-in;
  -webkit-appearance: none;

}



.label-success {background-color: #4CAF50;} /* Green */
.label-info {background-color: #2196F3;} /* Blue */
.label-warning {background-color: #ff9800;} /* Orange */
.label-danger {background-color: #f44336;} /* Red */ 
.label-other {background-color: #e7e7e7; color: black;} /* Gray */ 

</style>

      <!-- HEADER  -->

<table style="width:100%">
    <tr>

        <td colspan="5" style="height:50px">
            <!-- <input id="x_slider" type="range" min="1" max={{image_shape[2]}} step="1" value="15" name="x_slider"> -->
            <!-- <input id="y_slider" type="range" min="1" max={{image_shape[1]}} step="1" value="150" name="y_slider"> -->
          <!-- </p> -->

  <!-- <label for="fname">KEY:</label> -->
  <input type="text" id="key" name="key" placeholder="ACCESS KEY">
  <button id = 'key_check'> OK </button>
  <button id = 'reload' style="display: none"> Reload </button>
  <span id="status" class="label-other"></span>


<div id="display" style="display: none">
           <input type="file" id="selectFile" webkitdirectory directory multiple>
           <button id = 'render'> Render </button>

           <button id = 'prev_file' class="btn"> < Previous </button>
           <button id = 'next_file' class="btn">  Next > </button>

        <!-- <div id="XZFrame" > -->
        <!-- <canvas width="52" height="52" style="width: 52px; height: 52px; border:1px solid #000000;"></canvas> -->
      <!-- </div> -->
       <!-- <div id="YZFrame" > -->
        <!-- <canvas width="52" height="52" style="width: 52px; height: 52px; border:1px solid #000000;"></canvas> -->
      <!-- </div> -->
          
          <div class='wrap'>
            <label id="min_val"></label>
            <input id='minRange' type='range' min='0' value='0' max='50' class="slider"/>
            <input id='maxRange' type='range' min='50' value='100' max='100' class="slider"/>
            <label id="max_val"></label>
          </div>
          


            <button id = 'zoom_in' class="btn"> + </button>
            <button id = 'zoom_out' class="btn"> - </button>
            <button id="capture" class="btn">CAPTURE</button>
             <button id="RESET" class="btn2">Reset</button>
 

 </div>
             <!-- <button id="x256" class="btn">I-</button> -->
<!-- <div class="row">
        <form class="form-horizontal">
            <div class="form-group">
               
            </div>
        </form>
    </div> -->
            <!-- <input type="file" id="filepicker" name="fileList" webkitdirectory multiple/> -->
            <div id="result"> {{image_aspect_ratio[0]}} </div>
        </td>
    </tr>
    <tr>
      <!-- LIST MEANU  -->
        <td rowspan = "4" style="width:100px" valign="top">
          POINTS:
          [X,Y,Z]
          <table id="metCenters" >
  <tr>
    <td  valign="top"> </td>
  </tr>
</table>
  
        </td>
        <!-- SLIDER XYY  -->
         <td rowspan = "3" style="width:20px">
          <input id="xyy_slider" type="range" min="0" max="512" value="0" step="1" class="slider vertical" 
                    style="height: 512px ;"  >
        </td>
        <!--  XY  -->
         <td rowspan = "3">
              <div 
              style="position:relative;"> 
                  <div id="dicomImageWrapper" style="width:512px;height:512px;position:relative;color:white"
         oncontextmenu="return false"
         onmousedown="return false">

        <div id="XYFrame"
             style="width:512px;height:512px;top:0px;left:0px;position:absolute">
        </div>

        <div id="topleft" class="overlay" style="position:absolute;top:0px;left:0px">
            Patient Name
        </div>
        <div id="topright" class="overlay" style="position:absolute;top:0px;right:0px">
            Render Time:
        </div>
        <div id="bottomright" class="overlay" style="position:absolute;bottom:0px;right:0px">
            Zoom:
        </div>
        <div id="bottomleft" class="overlay" style="position:absolute;bottom:0px;left:0px">
            WW/WC:
        </div>
        <canvas id="Canvas_xy_overlay" width="512" height="512" 
                 style="border:1px solid #000fff; position: absolute; left: 0px; top: 0px; z-index: 1;"></canvas>
      </div>
            </div>
        </td>
        <!-- SLIDER XZZ  -->
         <td style="width:20px;">
          <input id="xzz_slider" type="range" min="0" max="246" value="0" step="1" class="slider vertical" 
                    style="height: 246px;"  >
        </td>
        <!--  XZ  -->
         <td>

              <div 
              style="position:relative;"> 
                  <div id="dicomImageWrapper_XZ" style="width:400px;height:246px;position:relative;color:white"
                   oncontextmenu="return false"
                   onmousedown="return false">
                  <div id="XZFrame"
                       style="width:400px;height:246px;top:0px;left:0px;position:absolute">
                  </div>
       <!--  <canvas id="Canvas_xz" width="400" height="246" 
                 style="border:1px solid #000fff; position: absolute; left: 0px; top: 0px; z-index: 1;"></canvas> -->
        <canvas id="Canvas_xz_overlay" width="400" height="246" 
                 style="border:1px solid #000fff; position: absolute; left: 0px; top: 0px; z-index: 1;"></canvas>
      </div>

            </div>



    <!--       <div style="position: relative;">
              <canvas id="Canvas_xz" width="400" height="246" 
                 style="border:2px solid #fff000; position: absolute; left: 0; top: -125; z-index: 0;"></canvas>
              <canvas id="Canvas_xz_overlay" width="400" height="246" 
                 style="border:1px solid #000fff; position: absolute; left: 0; top: -125; z-index: 1;"></canvas>
              </div> -->
        </td>
    </tr>
    <tr>
      <!-- EMPTY  -->
        <td>
        </td >
        <!-- SLIDER XZX  -->
        <td style="height:20px">
            <input id="xzx_slider" type="range" min="0" max="400" value="0" step="1" class="slider" 
            style="width: 400px;">
        </td>
    </tr>
        <tr>
          <!-- SLIDER YZZ  -->
        <td style="width:20px">
          <input id="yzz_slider" type="range" min="0" max="246" value="0" step="1" class="slider vertical"
          style="height: 246px;">
        </td>
        <!-- YZ  -->
        <td>
            <div 
              style="position:relative;"> 
                  <div id="dicomImageWrapper_YZ" style="width:400px;height:246px;position:relative;color:white"
                   oncontextmenu="return false"
                   onmousedown="return false">
                  <div id="YZFrame"
                       style="width:400px;height:246px;top:0px;left:0px;position:absolute">
                  </div>
        <!-- <canvas id="Canvas_yz" width="400" height="246" 
                 style="border:1px solid #000fff; position: absolute; left: 0px; top: 0px; z-index: 1;"></canvas> -->
        <canvas id="Canvas_yz_overlay" width="400" height="246" 
                 style="border:1px solid #000fff; position: absolute; left: 0px; top: 0px; z-index: 1;"></canvas>
      </div>
            </div>

        </td>
    </tr>
        <tr>
          <!-- EMPTY  -->
        <td>
        </td>
        <!-- SLIDER XYX  -->
        <td style="height:20px">
              <input id="xyx_slider" type="range" min="0" max="512" value="0" step="1" class="slider" 
              style="width: 512px;" >
        </td>
        <!-- EMPTY  -->
        <td>
         
        </td>
        <!-- SLIDER YZY  -->
        <td style="height:20px">
            <input id="yzy_slider" type="range" min="0" max="400" value="0" step="1" class="slider" 
           style="width: 400px;">
        </td>
    </tr>
</table>
